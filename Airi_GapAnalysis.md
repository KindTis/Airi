# Airi 개발 현황 점검 (2025-09-21)

## 현재 구현 요약
- `MainWindow.xaml`은 상단 검색/버튼과 2열 ListBox만 제공하며 DevPlan에 명시된 정렬, 무작위 재생, 상태 표시 UI가 없다.
- `Video.cs`는 이미지 경로만 가진 `VideoItem`과 초기화 헬퍼를 정의하지만 실질적인 메타데이터 바인딩이나 배우 필터를 구현하지 않는다.
- `VideoMetaParser.cs`는 nanojav.com을 즉시 크롤링해 썸네일을 다운로드하고 `Airi.json`을 생성하지만, 결과를 UI나 로컬 보관소에 다시 연결하지 않는다.
- JSON 보관소, 스캐너, 파서 큐 등 DevPlan의 핵심 컴포넌트가 코드에 존재하지 않으며 MVVM 구조도 구성되지 않았다.

## DevPlan 대비 주요 미비점 정리
### 2. 핵심 요구사항
- 검색은 원격 크롤링용으로만 사용되고 있고, DevPlan이 요구한 로컬 데이터 필터/정렬/무작위 재생/상태 표시 기능이 전무하다.
- 좌측 배우 리스트는 XAML에 빈 `ListBox`만 존재하고 데이터 연동이 없어 DevPlan의 배우 필터링 UX를 충족하지 못한다.

### 3·6·7. 파이프라인 & 구성요소
- 파일 시스템 `Scanner`, `ParseQueue`, `JsonStore`, `ViewModel` 등 계획된 계층이 구현되지 않았고, 시작 시 전체 스캔/비교/파서 병렬 실행 흐름도 없다.
- 현재 구조는 `MainWindow` 코드비하인드에서 모든 처리를 담당하여 MVVM, 비동기 파이프라인, 백그라운드 작업 분리를 달성하지 못함.

### 4. 데이터 모델과 JSON 스키마
- DevPlan의 `TargetFolder`, `VideoItem`, `VideoMeta` 레코드 구조가 전혀 구현되지 않았으며, `%AppData%/Airi/videos.json` 대신 실행 폴더의 `Airi.json`에 임시 리스트만 저장한다.
- 저장 시 기존 JSON을 읽어 병합하거나 삭제된 항목을 반영하지 않아 데이터 정합성 요구사항을 만족하지 못한다.

### 5. UI/UX 세부사항
- Virtualizing 패널, 썸네일 캐싱, 배우 복수 선택, 상태 바 등의 UI 요소가 구현되지 않았다.
- 썸네일은 다운로드만 하고 캐시 폴더(`%LocalAppData%/Airi/cache`)를 사용하지 않는다.

### 8. 네트워크/보안
- DevPlan은 로컬 메타데이터 파싱을 전제로 하지만, 현재 구현은 즉시 외부 사이트를 크롤링하므로 차단 위험과 법적 리스크가 있다.
- HTTP 타임아웃, 재시도, 사용자 알림이 없어 실패 시 무한 대기/무반응 가능성이 높다.

### 9·10·11. 성능·로깅·테스트
- 대용량 컬렉션 가상화, 파서 병렬 처리, Serilog 기반 로깅, 단위/통합/UI 테스트가 하나도 없다.

## 기능 및 품질 이슈 (현 코드 기준)
- `VideoItems`는 초기화 후 어디에서도 채워지지 않아 UI에 썸네일이 표시되지 않는다.
- `AddButton_Click`은 `SearchAsync`만 트리거하고 결과를 `VideoItems`나 JSON 스토어에 반영하지 않는다.
- `SearchAsync`는 앱 실행 시마다 `_videos`를 새로 만들기 때문에 중복 저장/불러오기가 불가능하다.
- 네트워크 요청과 파일 I/O 예외가 UI에 전달되지 않으며, 취소/중단 흐름도 없다.

## 권장 후속 작업 (우선순위)
1. **도메인 모델/스토어 정비**: DevPlan의 `TargetFolder`·`VideoMeta` 레코드 기반으로 JSON 스키마와 로컬 저장 경로를 구현하고, 읽기/쓰기/마이그레이션 로직을 분리한다.
2. **스캐닝 & 파서 파이프라인 구축**: 파일 시스템 스캐너, diff 계산, 백그라운드 파서 큐, 썸네일 캐시를 구성하고 비동기 플로우(`RunStartupAsync`)를 완성한다.
3. **MVVM 리팩터링**: `MainWindow` 코드비하인드에서 상태를 분리해 ViewModel/Service 계층을 만들고 `ObservableCollection` 대신 `CollectionView` 필터/정렬을 적용한다.
4. **UI 구현 확장**: 배우 리스트, 정렬/랜덤 버튼, 상태 바, Virtualizing 패널을 DevPlan의 레이아웃대로 채워 UX 요구사항을 충족시킨다.
5. **로깅·예외·테스트**: Serilog 기반 로깅, 사용자 피드백(대화상자 대신 토스트/상태바), 핵심 서비스 단위 테스트 및 파이프라인 통합 테스트를 준비한다.
